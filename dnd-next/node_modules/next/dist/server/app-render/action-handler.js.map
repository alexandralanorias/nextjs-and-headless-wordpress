{"version":3,"sources":["../../../src/server/app-render/action-handler.ts"],"names":["handleAction","formDataFromSearchQueryString","query","searchParams","URLSearchParams","formData","FormData","key","value","append","nodeHeadersToRecord","headers","record","Object","entries","undefined","Array","isArray","join","getForwardedHeaders","req","res","requestHeaders","requestCookies","responseHeaders","getHeaders","rawSetCookies","setCookies","map","setCookie","cookie","split","mergedHeaders","filterReqHeaders","actionsForbiddenHeaders","mergedCookies","concat","Headers","addRevalidationHeader","staticGenerationStore","requestStore","Promise","all","pendingRevalidates","isTagRevalidated","revalidatedTags","length","isCookieRevalidated","getModifiedCookieValues","mutableCookies","setHeader","JSON","stringify","createRedirectRenderResult","redirectUrl","startsWith","forwardedHeaders","set","RSC_HEADER","host","proto","incrementalCache","requestProtocol","fetchUrl","URL","NEXT_CACHE_REVALIDATED_TAGS_HEADER","NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER","prerenderManifest","preview","previewModeId","delete","headResponse","fetch","method","next","internal","get","RSC_CONTENT_TYPE_HEADER","response","includes","FlightRenderResult","body","err","console","error","RenderResult","HostType","XForwardedHost","Host","limitUntrustedHeaderValueForLogs","slice","ComponentMod","serverModuleMap","generateFlight","serverActions","ctx","actionId","ACTION","toLowerCase","contentType","isURLEncodedAction","isMultipartAction","isFetchAction","originDomain","forwardedHostHeader","hostHeader","type","warn","allowedOrigins","Error","statusCode","promise","reject","result","actionResult","skipFlight","pathWasRevalidated","bound","actionAsyncStorage","formState","run","isAction","process","env","NEXT_RUNTIME","decodeReply","decodeAction","decodeFormState","webRequest","request","action","actionReturnedState","actionData","reader","getReader","done","read","TextDecoder","decode","decodeReplyFromBusboy","require","busboy","bb","pipe","readableStream","ReadableStream","start","controller","on","chunk","enqueue","Uint8Array","close","fakeRequest","Request","duplex","chunks","push","Buffer","from","toString","readableLimit","bodySizeLimit","limit","parse","ApiError","actionModId","id","actionHandler","__next_app__","returnVal","apply","resolve","isRedirectError","getURLFromRedirectError","appendMutableCookies","values","isNotFoundError","asNotFound"],"mappings":"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"}